Ch. 5 SEQUENCE

---

1. 시퀀스 (Sequence) 개념

- 정의: 유일한 값을 생성해주는 오라클 객체.
- 용도: 주로 테이블의 기본키(Primary Key) 값을 순차적으로 자동 생성하기 위해 사용된다. (예: 게시글 번호 1, 2, 3...)
- 장점: 메모리에 캐시(Cache)되어 성능이 좋고, 동시성 제어가 가능하여 여러 사용자가 동시에 번호를 생성해도 중복되지 않는다.

---

2. 시퀀스 생성 (CREATE SEQUENCE)

- 기본 문법:
    
    sql
    CREATE SEQUENCE 시퀀스명
  	  [START WITH n]
  	  [INCREMENT BY n]
  	  [MAXVALUE n | NOMAXVALUE]
   	 [MINVALUE n | NOMINVALUE]
  	  [CYCLE | NOCYCLE]
   	 [CACHE n | NOCACHE];
    
    
- 주요 옵션:
    - START WITH n: 시퀀스의 시작 값을 지정한다. (기본값: 1)
    - INCREMENT BY n: 증가치를 지정한다. (기본값: 1, 음수면 감소)
    - MAXVALUE / MINVALUE: 시퀀스가 생성할 수 있는 최대값/최소값을 지정한다.
    - CYCLE / NOCYCLE: 최대값/최소값에 도달했을 때 순환 여부를 지정한다. (기본값: NOCYCLE)
    - CACHE / NOCACHE: 메모리에 미리 할당해 둘 번호의 개수를 지정한다. 속도가 빠르지만 시스템 장애 시 번호가 건너뛸 수 있다. (기본값: CACHE 20)

---

3. 시퀀스 사용 (의사 컬럼 Pseudo-columns)

시퀀스 값을 가져오거나 확인할 때 사용하는 가짜 컬럼.

- NEXTVAL (Next Value)
    - 기능: 시퀀스의 다음 값을 생성하여 반환한다.
    - 특징: 호출할 때마다 값이 증가(또는 감소)하여 영구적으로 반영된다.
    - 사용: INSERT 문에서 PK 값을 넣을 때 주로 사용한다.
    - *예시*: INSERT INTO member VALUES (member_seq.NEXTVAL, '홍길동');
- CURRVAL (Current Value)
    - 기능: 현재 세션에서 가장 최근에 생성된 시퀀스 값을 반환한다.
    - 주의: 세션 내에서 NEXTVAL을 최소 한 번은 호출한 후에만 사용할 수 있다. (아직 생성한 적이 없으면 에러 발생)

---

4. 시퀀스 수정 및 삭제

- ALTER SEQUENCE (수정)
    - 가능: 증가치(INCREMENT BY), 최대/최소값(MAXVALUE), 순환 여부(CYCLE), 캐시(CACHE) 등을 변경할 수 있다.
    - 불가: 시작 값(START WITH)은 변경할 수 없음. 시작 값을 바꾸려면 시퀀스를 삭제하고 다시 만들어야 한다.
    - *예시*: ALTER SEQUENCE my_seq INCREMENT BY 2; (증가치를 2로 변경)
- DROP SEQUENCE (삭제)
    - 시퀀스 객체를 완전히 삭제한다.
    - *예시*: DROP SEQUENCE my_seq;

---

5. 시퀀스 정보 조회 (Data Dictionary)

- USER_SEQUENCES: 현재 사용자가 소유한 모든 시퀀스의 정보를 조회할 수 있는 시스템 뷰.
- 확인 가능 정보: 시퀀스 이름, 최소/최대값, 증가치, 마지막 번호(LAST_NUMBER) 등.
- *주의*: LAST_NUMBER는 캐시를 사용하는 경우, 현재 사용된 번호가 아니라 캐시된 마지막 번호를 보여줄 수 있다.

---

실습 요약

1. 테이블과 시퀀스의 연동: 회원(MEMBER) 테이블을 만들고, 회원번호(ID)를 위한 시퀀스(MEMBER_ID_SEQ)를 생성한다.
2. 데이터 입력: INSERT 문을 실행할 때, ID 컬럼 자리에 직접 숫자를 쓰지 않고 MEMBER_ID_SEQ.NEXTVAL을 사용하여 자동으로 1, 2, 3... 순서로 들어가게 한다.
3. 상태 확인: SELECT MEMBER_ID_SEQ.CURRVAL FROM DUAL;로 방금 들어간 번호를 확인하거나, USER_SEQUENCES 테이블을 조회하여 시퀀스 설정을 확인한다.